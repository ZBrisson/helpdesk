# Silverlight remote updater/installer
# By: Zach Brisson
# 04/26/17
# You need to have the most up to date version in the silverlight folder on a shared network drive.

## get the list of computers from the text file
#$list_of_computers = get-content "C:\computerlist.txt"
# $list_of_computers = (Get-ADComputer -SearchBase 'OU=text,OU=placeholder,DC=Github,DC=local' -Filter '*' -Properties Name).Name
# $list_of_computers = $list_of_computers.Trim()
$list_of_computers = Read-Host "Type the name of a PC"

#display total count
Write-host "Gathered machines" $list_of_computers.count
# Silverlight .exe 32bit file path
$silverlight32Path = "Microsoft.PowerShell.Core\FileSystem::\\network\file\share\Silverlight.exe"
# Silverlight .exe 64bit file path
$silverlight64Path = "Microsoft.PowerShell.Core\FileSystem::\\network\file\share\\Silverlight_x64.exe"
#The .exe resting place on the remote computer
$installLocation = "Microsoft.PowerShell.Core\FileSystem::\\$computer\c$\Users\"


#Install Silverlight
 foreach ($computer in $list_of_computers) 
    {
        $installLocation = "Microsoft.PowerShell.Core\FileSystem::\\$computer\c$\ScriptLogic\"
        # Check if computer is online
        if (Test-Connection $computer -count 1 -Quiet)
        {
                ## check the Windows OS architecture
            if ((Get-WmiObject -ComputerName $computer win32_operatingsystem | select osarchitecture).osarchitecture -eq "64-bit")
            {

                Write-Host "$computer is a 64-bit OS" -ForegroundColor Green
                Copy-Item $silverlight64Path -Destination $installLocation -Force
                Write-Host "Copied silverlight successfully at $installLocation" -ForegroundColor Green
                $InstallString = "$installLocation\Silverlight_x64.exe /q"

        
            }else{
        
                Write-Host "$computer is a 32-bit OS" -ForegroundColor Green
                Copy-Item $silverlight32Path -Destination $installLocation -Force
                Write-Host "Copied silverlight successfully $installLocation" -ForegroundColor Green
                $InstallString = "$installLocation\Silverlight.exe /q"

            }
            # Install silverlight
            ([WMICLASS]"\\$computer\ROOT\CIMV2:Win32_Process").Create($InstallString) 
            Write-Host "Installed silverlight successfully" -ForegroundColor Green

        }
        else{

            # notify on screen that host is offline
            Write-Host "$computer is offline, skipping..." -ForegroundColor Yellow

        }

     }

Write-Host ""
Write-Host "Install script completed. Users will need to restart IE for changes to update." -ForegroundColor Green
Write-Host ""
Write-Host ""
Write-Host ""
Write-Host "Going to sleep for 3 minutes to let install finish and then delete the files" -ForegroundColor Yellow

#Remove downloaded files from remote computers
Start-Sleep 180
 foreach ($computer in $list_of_computers)  {
            Remove-Item $installLocation
            Write-Host "Removed .exe from $installLocation" -ForegroundColor Green
}
